{% extends "layout.html" %}

{% block content %}
      <li class="ui-field-contain">

<!--        Authentication-->
            <ul data-role="listview">
                <fieldset class="ui-grid-a">

              <li class="ui-field-contain" style="margin: 0 0 .5em 0">

<!--                    <form action = "/settings/access" method = "post">-->
                <label  class="select">Authentication Code:</label>
                  <div class="ui-block-a">
                        <input type="text" name="code" id="accescode"/>
                  </div></li>
                <li>
<!--                  <div class="ui-block-b">-->
                    <input type="submit" value="Authentication Code" data-theme="a" id="code"></input>
<!--                    </form>-->
<!--                    <form action = "/settings/discover" method = "post">-->
                        <input type="submit" value="discover" data-theme="a" id="discover"></input>
                        <br>

                    <br>

<!--                  </div>-->
                </li></fieldset></ul>
          <br>
          <br>

           <ul data-role="listview" data-inset="true">
    <li class="ui-field-contain">
      <h1 style="font-size:1.4em;">Doorbell</h1>
    </li>
    <li class="ui-field-contain">
      <label for="slider">Ignore -DB Sonos name</label>
                  <div id="slide">
      <select name="sonos_doorbell.ignore_sonos_names"
            id="slider" data-role="slider">
        <option value="off">Off</option>
        <option value="on">On</option>
      </select></div>

    </li>
           </ul>
<!--                  </form>-->
    <div id="div1"></div>


<!--                         <ul data-role="listview">-->
<!--&lt;!&ndash;                 {% if data == "Device found" %}&ndash;&gt;-->
<!--&lt;!&ndash;                             {% for name in group_name %}&ndash;&gt;-->
<!--              <li class="ui-field-contain">-->
<!--                <div data-role="collapsible" data-collapsed="false">-->
<!--                  <h4 id="heading">njvnj</h4>-->
<!--                  <ul data-role="listview">-->
<!--                    <li class="ui-field-contain">-->
<!--                      <label class="select">Name</label>-->
<!--                      <label>{{name}}</label>-->
<!--                    </li>-->
<!--                      <li class="ui-field-contain">-->
<!--                            <label class="select">Group ID</label>-->
<!--                            <label>{{group_id}}</label>-->
<!--                                </li>-->
<!--                      <li class="ui-field-contain">-->
<!--                            <label class="select">Group Volume</label>-->
<!--                            <label>{{volume}}</label>-->
<!--                                </li>-->
<!--                                </ul>-->
<!--                                 </div>-->
<!--                                </li>-->
<!--&lt;!&ndash;                             {% endfor %}&ndash;&gt;-->
<!--                         </ul>-->

<!--&lt;!&ndash;          {% else %}&ndash;&gt;-->
<!--           <ul data-role="listview">-->
<!--               <li>{{ data }}</li>-->
<!--&lt;!&ndash;               {% endif %}&ndash;&gt;-->
<!--           </ul>                    </form>-->


<!--          <li class="ui-field-contain">-->
<!--&lt;!&ndash;      <label for="sonos_doorbell.uploads" class="select">Grouping/Ungrouping</label>&ndash;&gt;-->
<!--      <div id="grouping" data-role="collapsible" data-collapsed="true">-->
<!--        <h4>Grouping/Ungrouping</h4>-->
<!--        <ul data-role="listview">-->
<!--          {% for i in range(1, 4) %}-->
<!--            <li class="ui-field-contain">-->
<!--              <label for="sound_config_{{i}}"-->
<!--                     class="select">Sonos {{i}}</label>-->
<!--              <div class="ui-grid-solo" id="sound_config_{{i}}">-->
<!--                <div class="ui-block-a">-->
<!--                  <label for="delete_sound_file_{{i}}">-->
<!--                             name-->
<!--                  </label>-->
<!--                  <input type="checkbox"-->
<!--                         id="delete_sound_file_{{i}}"-->
<!--                         name="delete_sound_file_{{i}}"/>-->
<!--                </div>-->
<!--              </div>-->
<!--            </li>-->
<!--          {% endfor %}-->
<!--            <input type="submit" value="submit" data-theme="a" id="group"></input>-->
<!--        </ul>-->
<!--      </div>-->
<!--    </li>-->
<br>

          <input type="range"
                 name="volume"
                 id="volume"
                 min="0" max="100"
                 value=""/>

                        <input type="submit" id="volumeset" value="Set Volume" data-theme="a"></input>
<!--                  <form action = "/settings/play" method = "post">-->
<!--                        <input type="submit" value="Damaged play button " data-theme="a"></input>-->
<!--                  </form>-->

<!--                    <form action = "/settings/play" method = "post">-->

                        <input type="submit" value="play " data-theme="a" id="play"></input>


<!--                  </form>-->


<!--                  <form action = "/settings/pause" method = "post">-->
                        <input type="submit" value="pause" data-theme="a" id="pause"></input>
<!--                  </form>-->
<!--          <form action = "/settings/skipToNextTrack" method = "post">-->
                        <input type="submit" value="Next Track" data-theme="a" id="skipToNextTrack"></input>
<!--                  </form>-->
<!--          <form action = "/settings/skipToPreviousTrack" method = "post">-->
                        <input type="submit" value="Previous Track" data-theme="a" id="skipToPreviousTrack" id="skipToPreviousTrack"></input>
<!--                  </form>-->
<!--          <form action = "/settings/setvolume" method = "post">-->


<!--                  </form>-->
      </li>

              </li>

<script>

    $(function(){
	$('#code').click(function(){
		 var access = $('#accescode').val();
			alert (access);

		$.ajax({
			url: '/settings/access',
			datatype:"json",
			data: {accesscode:access},
			type: 'GET',
			success: function(response){
				alert (response);
			},
		});
	});
});




    $(function(){
	$('#discover').click(function(){

<!--			alert ("discover");-->

		$.ajax({
			url: '/settings/discover',

			success: function(response){

<!--				alert (response);-->
				var returnedData =JSON.parse(response);
				if(returnedData.data == 'Device found')
				{
				$('#volume').val(returnedData.volume);

				    alert(returnedData.data);
                       $('#div1').empty();

                        for (i=0;i<returnedData.group_name.length;i++)
                        {
                        demo(returnedData.data,returnedData.group_name[i],returnedData.volume,returnedData.group_id);
                        }

                        $('#div2').empty();
                        collapse(returnedData.group_name);

				}
				else{
<!--    alert(returnedData.data);-->

				               $('#div1').empty();
				                $('#div1').append("<h4>No device found </h4>");
				}


			},
		});
	});
});

    $(function(){
	$('#volumeset').click(function(){
		 var vol = $('#volume').val();
			alert (vol);
		$.ajax({
			url: '/settings/setvolume',
			datatype:"json",
			data: {volume:vol},
			type: 'GET',
			success: function(response){
			var returnedData =JSON.parse(response);
				alert (returnedData.group_name);
				for(i=0;i<returnedData.group_name.length;i++)
				{
				document.getElementById(returnedData.group_name[i]).innerHTML = vol ;
				}
			},
		});
	});
});

    $(function(){
	$('#play').click(function(){

			alert ("play");

		$.ajax({
			url: '/settings/play',

			success: function(response){
				alert ("success");
			},
		});
	});
});

$(function(){
	$('#pause').click(function(){

			alert ("pause");

		$.ajax({
			url: '/settings/pause',

			success: function(response){
				alert ("success");
			},
		});
	});
});

$(function(){
	$('#skipToNextTrack').click(function(){

			alert ("skipToNextTrack");

		$.ajax({
			url: '/settings/skipToNextTrack',

			success: function(response){
				alert ("success");
			},
		});
	});
});

$(function(){
	$('#skipToPreviousTrack').click(function(){

			alert ("skipToPreviousTrack");

		$.ajax({
			url: '/settings/skipToPreviousTrack',

			success: function(response){
				alert ("success");
			},
		});
	});
});


function demo(data,groupname,vol,group_id)
{
str ="";
    str += '<ul data-role="listview">'+
                  '<li class="ui-field-contain">'+
                    '<div data-role="collapsible" data-collapsed="false">'+
                      '<h4 id="heading">'+groupname+'</h4>'+
                      '<ul data-role="listview">'+
                        '<li class="ui-field-contain">'+
                         ' <label class="select">Name</label>'+
                          '<label>'+groupname+'</label>'+
                        '</li>'+
                          '<li class="ui-field-contain">'+
                                '<label class="select">Group ID</label>'+
                                '<label>'+group_id+'</label>'+
                                    '</li>'+
                          '<li class="ui-field-contain">'+
                                '<label class="select">Group Volume</label>'+
                                '<label id="'+groupname+'">'+vol+'</label>'+
                                    '</li>'+
                           '</ul>'+
                                     '</div>'+
                                    '</li>'+
                          '</ul>'

       $('#div1').append(str);
    }
function collapse(groupname)
{
str ="";
str += ' <ul data-role="listview"><li class="ui-field-contain">'+
      '<div id="grouping" data-role="collapsible" data-collapsed="true">'+
        '<h4>Grouping/Ungrouping</h4>'+
        '<ul data-role="listview">'


 for(i=0;i<groupname.length;i++)
 {
 str += '<li class="ui-field-contain">'+
              '<label for="'+i+'"'+
                     'class="select">Sonos '+i+'</label>'+
              '<div class="ui-grid-solo" id="'+i+'">'+
                '<div class="ui-block-a">'+
                  '<label for="">'+groupname[i]+
                  '</label>'+
                  '<input type="checkbox"'+
                        ' id="group_checkbox"'+
                         'name="'+groupname[i]+'" value="'+groupname[i]+'"/>'+
                '</div>'+
              '</div>'+
            '</li>'

 }

str += '<input type="submit" id="group" data-theme="a" value="Group/Ungroup"/>'+
<!--        '<input type="ungrouping" id="demo" value="Ungroup"/>'+-->
        '</ul>'+
      '</div>'+
    '</li><ul data-role="listview">'

 $('#div1').append(str);

 $(function(){
	$('#group').click(function(){

		var group_sonos = [];
		var ungroup_sonos = [];

            $.each($("input[id='group_checkbox']:checked"), function(){
                group_sonos.push($(this).val());
            });
              $.each($("input[id='group_checkbox']:not(:checked)"), function(){
                ungroup_sonos.push($(this).val());
            });
            alert(ungroup_sonos);
            $.ajax({
			url: '/settings/group',
			datatype:"json",
			data: {group_sonos_list:group_sonos,
			ungroup_sonos_list:ungroup_sonos},
			type: 'GET',
			success: function(response){
				alert ("success");
			},
		});


	});
});
}

    $(function(){
    $('#slide').click(function(){
    if( $('#slider').val() == 'on')
    {
    $.ajax({
			url: '/settings/ignoreDB',
			datatype:"json",
			data: {},
			type: 'GET',
			success: function(response){
				alert ("success");
			},
		});
    }
  });
  });

</script>

</body>

{% endblock %}

